<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="origin" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <title>WebSocket Demo</title>
	<style type="text/css">
	#box{position:fixed;top:10px;left:10px;bottom:10px;right:10px;border:1px #999 solid;}
	#ball,#ball2,#ball3{position:absolute;width:50px;height:50px;border-radius:25px;}
	#ball{background:#f20;}
	#ball2{background:#999;}
	#ball3{background:#02f;}
	</style>
</head>
<body>
	<div id="box">
		<span id="ball"></span>
		<span id="ball2"></span>
		<span id="ball3"></span>
	</div>
	<script type="text/javascript">
	const box = document.getElementById('box');
	const ball = document.getElementById('ball');
	const ball2 = document.getElementById('ball2');
	var width = 0, height = 0;
	var p1 = {x: 0,y: 0}, p2 = {x: 0,y: 0};
	var angle = 0, angle2 = 0, radius = 0, maxRadius = 0;
	
	document.body.onload = function() {
		width = box.clientWidth - ball.clientWidth;
		height = box.clientHeight - ball.clientHeight;
		
		p1.x = parseInt(width * Math.random());
		p1.y = parseInt(height * Math.random());
		do {
			angle = parseInt(360 * Math.random());
		} while(angle % 90 < 5);
		radius = 0;
		calcRadius();
	};
	document.body.onresize = function() {
		this.onload();
	};
	function calcRadius() {
		if(angle < 90) {
			angle2 = Math.atan(p1.y / (width-p1.x))*180/Math.PI;
			if(angle > angle2) {
				maxRadius = p1.y / Math.cos((90-angle) * Math.PI / 180);
				p2.x = p1.x + maxRadius * Math.cos(angle * Math.PI / 180);
				p2.y = 0;
			} else {
				maxRadius = (width-p1.x) / Math.cos(angle * Math.PI / 180);
				p2.x = width;
				p2.y = p1.y - maxRadius * Math.sin(angle * Math.PI / 180);
			}
		} else if(angle < 180) {
			angle2 = 180 - Math.atan(p1.y / p1.x)*180/Math.PI;
			if(angle > angle2) {
				maxRadius = p1.x / Math.cos((180-angle) * Math.PI / 180);
				p2.x = 0;
				p2.y = p1.y - maxRadius * Math.sin(angle * Math.PI / 180);
			} else {
				maxRadius = p1.y / Math.cos((angle-90) * Math.PI / 180);
				p2.x = p1.x + maxRadius * Math.cos(angle * Math.PI / 180);
				p2.y = 0;
			}
		} else if(angle < 270) {
			angle2 = 270 - Math.atan(p1.x / (height-p1.y))*180/Math.PI;
			if(angle > angle2) {
				maxRadius = (height-p1.y) / Math.cos((270-angle) * Math.PI / 180);
				p2.x = p1.x + maxRadius * Math.cos(angle * Math.PI / 180);
				p2.y = height;
			} else {
				maxRadius = p1.x / Math.cos((angle-180) * Math.PI / 180);
				p2.x = 0;
				p2.y = p1.y - maxRadius * Math.sin(angle * Math.PI / 180);
			}
		} else {
			angle2 = 360 - Math.atan((height-p1.y) / (width-p1.x))*180/Math.PI;
			if(angle > angle2) {
				maxRadius = (width-p1.x) / Math.cos((360-angle) * Math.PI / 180);
				p2.x = width;
				p2.y = p1.y - maxRadius * Math.sin(angle * Math.PI / 180);
			} else {
				maxRadius = (height-p1.y) / Math.cos((angle-270) * Math.PI / 180);
				p2.x = p1.x + maxRadius * Math.cos(angle * Math.PI / 180);
				p2.y = height;
			}
		}

		ball.style.left = p1.x + 'px';
		ball.style.top = p1.y + 'px';
		ball2.style.left = p2.x + 'px';
		ball2.style.top = p2.y + 'px';
		ball3.style.left = p1.x + 'px';
		ball3.style.top = p1.y + 'px';

		console.log("width = " + width + ", height = " + height + ", angle = " + angle + ", angle2 = " + angle2);
	}
	setInterval(function() {
		radius += 10;
		if(radius >= maxRadius) {
			radius = 0;
			p1.x = p2.x;
			p1.y = p2.y;
			if(angle < 90) {
				if(angle > angle2) {
					angle = 360 - (90 - (90 - angle));
				} else {
					angle = (90 - angle) + 90;
				}
			} else if(angle < 180) {
				if(angle > angle2) {
					angle = 90 - (90 - (180 - angle));
				} else {
					angle = (angle - 90) + 180;
				}
			} else if(angle < 270) {
				if(angle > angle2) {
					angle = 180 - (90 - (270 - angle));
				} else {
					angle = 270 + (90 - (angle - 180));
				}
			} else {
				if(angle > angle2) {
					angle = 270 - (90 - (360 - angle));
				} else {
					angle = 90 - (angle - 270);
				}
			}
			calcRadius();
		} else {
			const x = p1.x + radius * Math.cos(angle * Math.PI / 180);
			const y = p1.y - radius * Math.sin(angle * Math.PI / 180);
			ball3.style.left = x + 'px';
			ball3.style.top = y + 'px';
		}
	}, 20);
	</script>
</body>
</html>

